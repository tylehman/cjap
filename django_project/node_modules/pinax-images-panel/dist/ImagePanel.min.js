/**
 * Pinax Images Panel v0.2.2
 *
 * Copyright (c) 2016-present, James Tauber and Contributors.
 * All rights reserved.
 *
 * This source code is licensed under the MIT license.
 */
var ImagePanel=function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(8);e.exports=r},function(e,t){"use strict";function n(e){return"[object Array]"===y.call(e)}function r(e){return"[object ArrayBuffer]"===y.call(e)}function a(e){return"[object FormData]"===y.call(e)}function o(e){var t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function i(e){return"string"==typeof e}function s(e){return"number"==typeof e}function l(e){return"undefined"==typeof e}function u(e){return null!==e&&"object"==typeof e}function c(e){return"[object Date]"===y.call(e)}function f(e){return"[object File]"===y.call(e)}function p(e){return"[object Blob]"===y.call(e)}function d(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function h(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement}function m(e,t){var r,a,o;if(null!==e&&"undefined"!=typeof e)if("object"==typeof e||n(e)||(e=[e]),n(e))for(r=0,a=e.length;a>r;r++)t.call(null,e[r],r,e);else for(o in e)e.hasOwnProperty(o)&&t.call(null,e[o],o,e)}function g(){function e(e,t){"object"==typeof r[t]&&"object"==typeof e?r[t]=g(r[t],e):r[t]=e}var t,n,r={};for(t=0,n=arguments.length;n>t;t++)m(arguments[t],e);return r}var y=Object.prototype.toString;e.exports={isArray:n,isArrayBuffer:r,isFormData:a,isArrayBufferView:o,isString:i,isNumber:s,isObject:u,isUndefined:l,isDate:c,isFile:f,isBlob:p,isStandardBrowserEnv:h,forEach:m,merge:g,trim:d}},function(e,t){e.exports=React},function(e,t,n){"use strict";var r,a,o,i,s=n(12);s.defaults.xsrfCookieName="csrftoken",s.defaults.xsrfHeaderName="X-CSRFToken",r=function(e){return s.get(e)},a=function(e){return s.post(e)},o=function(e){var t,n,r,a=null;if(document.cookie&&""!==document.cookie)for(t=document.cookie.split(";"),n=0;n<t.length;n++)if(r=jQuery.trim(t[n]),r.substring(0,e.length+1)===e+"="){a=decodeURIComponent(r.substring(e.length+1));break}return a},i={getImages:r,postUrl:a,getCookie:o},e.exports=i},function(e,t,n){"use strict";var r=n(1),a=n(19),o=n(24),i=n(5),s=n(23),l=window.btoa||n(18);e.exports=function(e,t,u){var c,f,p,d,h,m=u.data,g=u.headers;if(r.isFormData(m)&&delete g["Content-Type"],c=new XMLHttpRequest,!window.XDomainRequest||"withCredentials"in c||s(u.url)||(c=new window.XDomainRequest),u.auth&&(f=u.auth.username||"",p=u.auth.password||"",g.Authorization="Basic "+l(f+":"+p)),c.open(u.method.toUpperCase(),a(u.url,u.params,u.paramsSerializer),!0),c.timeout=u.timeout,c.onload=function(){var n,r,a;c&&(n="getAllResponseHeaders"in c?o(c.getAllResponseHeaders()):null,r=-1!==["text",""].indexOf(u.responseType||"")?c.responseText:c.response,a={data:i(r,n,u.transformResponse),status:1223===c.status?204:c.status,statusText:1223===c.status?"No Content":c.statusText,headers:n,config:u},(a.status>=200&&a.status<300||!("status"in c)&&a.responseText?e:t)(a),c=null)},c.onerror=function(){t(new Error("Network Error")),c=null},r.isStandardBrowserEnv()&&(d=n(21),h=u.withCredentials||s(u.url)?d.read(u.xsrfCookieName):void 0,h&&(g[u.xsrfHeaderName]=h)),"setRequestHeader"in c&&r.forEach(g,function(e,t){"undefined"==typeof m&&"content-type"===t.toLowerCase()?delete g[t]:c.setRequestHeader(t,e)}),u.withCredentials&&(c.withCredentials=!0),u.responseType)try{c.responseType=u.responseType}catch(y){if("json"!==c.responseType)throw y}r.isArrayBuffer(m)&&(m=new DataView(m)),c.send(m)}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e,t,n){return r.forEach(n,function(n){e=n(e,t)}),e}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s,l=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),c=r(u),f=n(3),p=r(f);n(26),s=function(e){function t(e){a(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.handleChange=n.handleChange.bind(n),n}return i(t,e),l(t,[{key:"handleChange",value:function(e){var t,n,r,a,o,i,s,l;console.log(e),t=FileAPI.getFiles(e),n=function(e){return/^image/.test(e.type)},r=this.props.onUploadComplete,a=this.props.onFileUploadComplete,o=this.props.onUploadStart,i=this.props.onProgress,s=this.props.onFileProgress,l=this.props.uploadUrl,FileAPI.filterFiles(t,n,function(e){e.length&&FileAPI.upload({url:l,files:{files:e},headers:{"X-CSRFToken":p.default.getCookie("csrftoken")},filecomplete:function(e,t,n,r){if(a){var o=JSON.parse(t.responseText);l=o.upload_url,a(e,t,n,r)}},prepare:function(e,t){t.url=l},complete:function(t,n){r&&r(t,n,e)},progress:function(e,t,n,r){i&&i(e,t,n,r)},upload:function(e,t){o&&o(e,t)},fileprogress:function(e,t,n,r){s&&s(e,t,n,r)}})})}},{key:"render",value:function(){return c.default.createElement("span",{className:"btn-add-image"},"Browse ",c.default.createElement("input",{type:"file",name:"files",multiple:!0,onChange:this.handleChange}))}}]),t}(c.default.Component),s.propTypes={onUploadComplete:c.default.PropTypes.func,onFileUploadComplete:c.default.PropTypes.func,onUploadStart:c.default.PropTypes.func,onProgress:c.default.PropTypes.func,onFileProgress:c.default.PropTypes.func,uploadUrl:c.default.PropTypes.string.isRequired,imageSetId:c.default.PropTypes.number},e.exports=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),u=r(l),c=n(11),f=r(c),p=function(e){function t(e){a(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.handleSelectImage=n.handleSelectImage.bind(n),n.render=n.render.bind(n),n}return i(t,e),s(t,[{key:"handleSelectImage",value:function(e){this.props.onSelectImage(e)}},{key:"render",value:function(){var e=this.handleSelectImage,t=this.props.images.map(function(t,n){return u.default.createElement(f.default,{onSelectImage:e,image:t,key:n})});return u.default.createElement("div",{className:"col-md-3 image-list"},t)}}]),t}(u.default.Component);p.propTypes={images:u.default.PropTypes.array.isRequired,onSelectImage:u.default.PropTypes.func.isRequired},e.exports=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),u=r(l),c=n(9),f=r(c),p=n(6),d=r(p),h=n(7),m=r(h),g=n(10),y=r(g),v=n(3),b=r(v),w=function(e){function t(e){a(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.render=n.render.bind(n),n.componentDidMount=n.componentDidMount.bind(n),n.refreshWithResponse=n.refreshWithResponse.bind(n),n.postAndRefresh=n.postAndRefresh.bind(n),n.deleteImage=n.deleteImage.bind(n),n.markPrimary=n.markPrimary.bind(n),n.handleOnUploadComplete=n.handleOnUploadComplete.bind(n),n.handleOnFileUploadComplete=n.handleOnFileUploadComplete.bind(n),n.handleOnFileProgress=n.handleOnFileProgress.bind(n),n.handleOnSelectImage=n.handleOnSelectImage.bind(n),n.handleOnUploadStart=n.handleOnUploadStart.bind(n),n.state={selectedImage:{},images:[],percentageComplete:0,totalToUpload:0,totalUploaded:0,imageSetId:n.props.initialImageSetId,uploadUrl:n.props.initialUploadUrl},n}return i(t,e),s(t,[{key:"componentDidMount",value:function(){console.log("mount",this.props),this.props.imagesUrl&&b.default.getImages(this.props.imagesUrl).then(this.refreshWithResponse)}},{key:"refreshWithResponse",value:function(e){var t=e.data.primaryImage;!t.hasOwnProperty("medium_thumbnail")&&e.data.images.length>0&&(t=e.data.images[0]),this.setState({selectedImage:t,images:e.data.images,imageSetId:e.data.pk,uploadUrl:e.data.upload_url})}},{key:"postAndRefresh",value:function(e){b.default.postUrl(e).then(this.refreshWithResponse)}},{key:"deleteImage",value:function(e){return this.postAndRefresh(e.delete_url),!1}},{key:"markPrimary",value:function(e){return this.postAndRefresh(e.make_primary_url),!1}},{key:"handleOnUploadComplete",value:function(){this.setState({totalToUpload:0,totalUploaded:0,percentageComplete:0})}},{key:"handleOnFileUploadComplete",value:function(e,t,n){var r=this.state.totalUploaded+n.size,a=JSON.parse(t.responseText);this.setState({totalUploaded:r,percentageComplete:Math.round(r/this.state.totalToUpload*100)}),this.refreshWithResponse({data:a})}},{key:"handleOnFileProgress",value:function(e){this.setState({percentageComplete:Math.round((this.state.totalUploaded+e.loaded)/this.state.totalToUpload*100)})}},{key:"handleOnSelectImage",value:function(e){this.setState({selectedImage:e})}},{key:"handleOnUploadStart",value:function(e,t){var n=0;t.files.files.forEach(function(e){n+=e.size}),this.setState({totalToUpload:n})}},{key:"render",value:function(){var e=null,t=null;return this.state.percentageComplete>0&&(e=u.default.createElement(y.default,{percentageComplete:this.state.percentageComplete})),this.state.imageSetId&&(t=u.default.createElement("input",{type:"hidden",name:"imageset",value:this.state.imageSetId})),u.default.createElement("div",{className:"media-panel"},u.default.createElement("div",{className:"panel-body"},e,u.default.createElement("div",{className:"row"},u.default.createElement(f.default,{image:this.state.selectedImage,deleteImage:this.deleteImage,markPrimaryImage:this.markPrimary}),u.default.createElement(m.default,{images:this.state.images,onSelectImage:this.handleOnSelectImage}))),t,u.default.createElement("div",{className:"panel-footer"},u.default.createElement(d.default,{uploadUrl:this.state.uploadUrl,onUploadComplete:this.handleOnUploadComplete,onFileUploadComplete:this.handleOnFileUploadComplete,onFileProgress:this.handleOnFileProgress,onUploadStart:this.handleOnUploadStart})))}}]),t}(u.default.Component);w.propTypes={initialImageSetId:u.default.PropTypes.number,imagesUrl:u.default.PropTypes.string,initialUploadUrl:u.default.PropTypes.string.isRequired},e.exports=w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),u=r(l),c=function(e){function t(e){a(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.handleDeleteClick=n.handleDeleteClick.bind(n),n.handleMarkPrimaryClick=n.handleMarkPrimaryClick.bind(n),n.render=n.render.bind(n),n}return i(t,e),s(t,[{key:"handleDeleteClick",value:function(){this.props.deleteImage(this.props.image)}},{key:"handleMarkPrimaryClick",value:function(){this.props.markPrimaryImage(this.props.image)}},{key:"render",value:function(){var e,t,n={},r="selected-image";return this.props.image.is_primary&&(r+=" primary"),this.props.image.medium_thumbnail?(e=this.props.image.medium_thumbnail,t="url("+e+")",n={backgroundImage:t}):r+=" empty",u.default.createElement("div",{className:"col-md-9"},u.default.createElement("div",{className:r,style:n},u.default.createElement("div",{id:"overlay"},u.default.createElement("a",{href:"#",className:"delete-image",onClick:this.handleDeleteClick},u.default.createElement("i",{className:"fa fa-trash fa-3x"})),u.default.createElement("a",{href:"#",className:"make-primary-image",onClick:this.handleMarkPrimaryClick},u.default.createElement("i",{className:"fa fa-check fa-3x"})))))}}]),t}(u.default.Component);c.propTypes={image:u.default.PropTypes.object.isRequired,deleteImage:u.default.PropTypes.func.isRequired,markPrimaryImage:u.default.PropTypes.func.isRequired},e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),u=r(l),c=function(e){function t(e){a(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.render=n.render.bind(n),n}return i(t,e),s(t,[{key:"render",value:function(){var e=this.props.percentageComplete,t={width:e+"%"};return u.default.createElement("div",{className:"progress"},u.default.createElement("div",{className:"progress-bar",role:"progressbar","aria-valuenow":this.props.percentageComplete,"aria-valuemin":"0","aria-valuemax":"100",style:t},this.props.percentageComplete,"%"))}}]),t}(u.default.Component);c.propTypes={percentageComplete:u.default.PropTypes.number.isRequired},e.exports=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),u=r(l),c=function(e){function t(e){a(this,t);var n=o(this,Object.getPrototypeOf(t).call(this,e));return n.handleSelectImage=n.handleSelectImage.bind(n),n.render=n.render.bind(n),n}return i(t,e),s(t,[{key:"handleSelectImage",value:function(){this.props.onSelectImage(this.props.image)}},{key:"render",value:function(){var e="";return this.props.image.is_primary&&(e="primary"),u.default.createElement("img",{className:e,src:this.props.image.small_thumbnail,onClick:this.handleSelectImage})}}]),t}(u.default.Component);c.propTypes={image:u.default.PropTypes.object.isRequired,onSelectImage:u.default.PropTypes.func.isRequired},e.exports=c},function(e,t,n){e.exports=n(13)},function(e,t,n){"use strict";function r(e){this.defaults=s.merge({},e),this.interceptors={request:new u,response:new u}}var a,o,i=n(16),s=n(1),l=n(15),u=n(14),c=n(22),f=n(20),p=n(17),d=n(5);r.prototype.request=function(e){var t,n;for("string"==typeof e&&(e=s.merge({url:arguments[0]},arguments[1])),e=s.merge(i,this.defaults,{method:"get"},e),e.baseURL&&!c(e.url)&&(e.url=f(e.baseURL,e.url)),e.withCredentials=e.withCredentials||this.defaults.withCredentials,e.data=d(e.data,e.headers,e.transformRequest),e.headers=s.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),s.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),t=[l,void 0],n=Promise.resolve(e),this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n},a=new r(i),o=e.exports=p(r.prototype.request,a),o.create=function(e){return new r(e)},o.defaults=a.defaults,o.all=function(e){return Promise.all(e)},o.spread=n(25),o.interceptors=a.interceptors,s.forEach(["delete","get","head"],function(e){r.prototype[e]=function(t,n){return this.request(s.merge(n||{},{method:e,url:t}))},o[e]=p(r.prototype[e],a)}),s.forEach(["post","put","patch"],function(e){r.prototype[e]=function(t,n,r){return this.request(s.merge(r||{},{method:e,url:t,data:n}))},o[e]=p(r.prototype[e],a)})},function(e,t,n){"use strict";function r(){this.handlers=[]}var a=n(1);r.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){a.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=r},function(e,t,n){(function(t){"use strict";e.exports=function(e){return new Promise(function(r,a){try{var o;"function"==typeof e.adapter?o=e.adapter:"undefined"!=typeof XMLHttpRequest?o=n(4):"undefined"!=typeof t&&(o=n(4)),"function"==typeof o&&o(r,a,e)}catch(i){a(i)}})}}).call(t,n(27))},function(e,t,n){"use strict";var r=n(1),a=/^\)\]\}',?\n/,o={"Content-Type":"application/x-www-form-urlencoded"};e.exports={transformRequest:[function(e,t){return r.isFormData(e)?e:r.isArrayBuffer(e)?e:r.isArrayBufferView(e)?e.buffer:!r.isObject(e)||r.isFile(e)||r.isBlob(e)?e:(r.isUndefined(t)||(r.forEach(t,function(e,n){"content-type"===n.toLowerCase()&&(t["Content-Type"]=e)}),r.isUndefined(t["Content-Type"])&&(t["Content-Type"]="application/json;charset=utf-8")),JSON.stringify(e))}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(a,"");try{e=JSON.parse(e)}catch(t){}}return e}],headers:{common:{Accept:"application/json, text/plain, */*"},patch:r.merge(o),post:r.merge(o),put:r.merge(o)},timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN"}},function(e,t){"use strict";e.exports=function(e,t){return function(){var n,r=new Array(arguments.length);for(n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t){"use strict";function n(e){this.message=e}function r(e){var t,r,o,i,s=String(e),l="";for(o=0,i=a;s.charAt(0|o)||(i="=",o%1);l+=i.charAt(63&t>>8-o%1*8)){if(r=s.charCodeAt(o+=.75),r>255)throw new n("INVALID_CHARACTER_ERR: DOM Exception 5");t=t<<8|r}return l}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.code=5,n.prototype.name="InvalidCharacterError",e.exports=r},function(e,t,n){"use strict";function r(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var a=n(1);e.exports=function(e,t,n){var o,i;return t?(n?o=n(t):(i=[],a.forEach(t,function(e,t){null!==e&&"undefined"!=typeof e&&(a.isArray(e)&&(t+="[]"),a.isArray(e)||(e=[e]),a.forEach(e,function(e){a.isDate(e)?e=e.toISOString():a.isObject(e)&&(e=JSON.stringify(e)),i.push(r(t)+"="+r(e))}))}),o=i.join("&")),o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e):e}},function(e,t){"use strict";e.exports=function(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}},function(e,t,n){"use strict";var r=n(1);e.exports=r.isStandardBrowserEnv()?function(){return{write:function(e,t,n,a,o,i){var s=[];s.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(a)&&s.push("path="+a),r.isString(o)&&s.push("domain="+o),i===!0&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";var r=n(1);e.exports=r.isStandardBrowserEnv()?function(){function e(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}var t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),a=e(window.location.href);return function(t){var n=r.isString(t)?e(t):t;return n.protocol===a.protocol&&n.host===a.host}}():function(){return function(){return!0}}()},function(e,t,n){"use strict";var r=n(1);e.exports=function(e){var t,n,a,o={};return e?(r.forEach(e.split("\n"),function(e){a=e.indexOf(":"),t=r.trim(e.substr(0,a)).toLowerCase(),n=r.trim(e.substr(a+1)),t&&(o[t]=o[t]?o[t]+", "+n:n)}),o):o}},function(e,t){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){var r,a;/*! FileAPI 2.0.19 - BSD | git://github.com/mailru/FileAPI.git
	 * FileAPI — a set of  javascript tools for working with files. Multiupload, drag'n'drop and chunked file upload. Images: crop, resize and auto orientation by EXIF.
	 */
!function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,n=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),r=n&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),a=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(n||a)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,i,s,l,u;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),o=new ArrayBuffer(t.length),i=new Uint8Array(o),s=0;s<t.length;s+=1)i[s]=t.charCodeAt(s);return l=e.split(",")[0].split(":")[1].split(";")[0],n?new Blob([r?i:o],{type:l}):(u=new a,u.append(o),u.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,n,r){e(r&&t.toDataURL&&o?o(this.toDataURL(n,r)):this.mozGetAsFile("blob",n))}:t.toDataURL&&o&&(t.toBlob=function(e,t,n){e(o(this.toDataURL(t,n)))})),e.dataURLtoBlob=o}(window),function(e,t){"use strict";function n(e,t,n,r,a){var o={type:n.type||n,target:e,result:r};Q(o,a),t(o)}function r(e){return C&&!!C.prototype["readAs"+e]}function a(e,a,o,i){if(ne.isBlob(e)&&r(o)){var s=new C;$(s,X,function u(t){var r=t.type;"progress"==r?n(e,a,t,t.target.result,{loaded:t.loaded,total:t.total}):"loadend"==r?(Y(s,X,u),s=null):n(e,a,t,t.target.result)});try{i?s["readAs"+o](e,i):s["readAs"+o](e)}catch(l){n(e,a,"error",t,{error:l.toString()})}}else n(e,a,"error",t,{error:"filreader_not_support_"+o})}function o(e,t){if(!e.type&&(w||e.size%4096===0&&e.size<=102400))if(C)try{var n=new C;Z(n,X,function(e){var r="error"!=e.type;r?(null!=n.readyState&&n.readyState!==n.LOADING||n.abort(),t(r)):t(!1,n.error)}),n.readAsDataURL(e)}catch(r){t(!1,r)}else t(null,new Error("FileReader is not supported"));else t(!0)}function i(e){return e&&(e.isFile||e.isDirectory)}function s(e){var t;return e.getAsEntry?t=e.getAsEntry():e.webkitGetAsEntry&&(t=e.webkitGetAsEntry()),t}function l(e,t){var n,r,a,o,i,u,c;e?e.isFile?e.file(function(n){n.fullPath=e.fullPath,t(!1,[n],[n])},function(n){e.error=n,t("FileError.code: "+n.code,[],[e])}):e.isDirectory?(r=e.createReader(),a=!0,o=[],i=[e],u=function(n){e.error=n,t("DirectoryError.code: "+n.code,o,i)},c=function f(n){a&&(a=!1,n.length||(e.error=new Error("directory is empty"))),n.length?ne.afor(n,function(e,t){l(t,function(t,n,a){t||(o=o.concat(n)),i=i.concat(a),e?e():r.readEntries(f,u)})}):t(!1,o,i)},r.readEntries(c,u)):l(s(e),t):(n=new Error("invalid entry"),e=new Object(e),e.error=n,t(n.message,[],[e]))}function u(e){var t={};return K(e,function(e,n){e&&"object"==typeof e&&void 0===e.nodeType&&(e=Q({},e)),t[n]=e}),t}function c(e){return B.test(e&&e.tagName)}function f(e){return(e.originalEvent||e||"").dataTransfer||{}}function p(e){var t;for(t in e)if(e.hasOwnProperty(t)&&!(e[t]instanceof Object||"overlay"===t||"filter"===t))return!0;return!1}var d,h,m=1,g=function(){},y=e.document,v=y.doctype||{},b=e.navigator.userAgent,w=/safari\//i.test(b)&&!/chrome\//i.test(b),x=/iemobile\//i.test(b),A=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL&&webkitURL,I=e.Blob,F=e.File,C=e.FileReader,T=e.FormData,E=e.XMLHttpRequest,R=e.jQuery,P=!(!(F&&C&&(e.Uint8Array||T||E.prototype.sendAsBinary))||w&&/windows/i.test(b)&&!x),k=P&&"withCredentials"in new E,O=P&&!!I&&!!(I.prototype.webkitSlice||I.prototype.mozSlice||I.prototype.slice),_=(""+"".normalize).indexOf("[native code]")>0,S=e.dataURLtoBlob,U=/img/i,j=/canvas/i,D=/img|canvas/i,B=/input/i,N=/^data:[^,]+,/,L={}.toString,M=e.Math,z=function(t){return t=new e.Number(M.pow(1024,t)),t.from=function(e){return M.round(e*this)},t},H={},q=[],X="abort progress error load loadend",W="status statusText readyState response responseXML responseText responseBody".split(" "),G="currentTarget",V="preventDefault",J=function(e){return e&&"length"in e},K=function(e,t,n){var r,a,o;if(e)if(J(e))for(r=0,a=e.length;a>r;r++)r in e&&t.call(n,e[r],r,e);else for(o in e)e.hasOwnProperty(o)&&t.call(n,e[o],o,e)},Q=function(e){for(var t=arguments,n=1,r=function(t,n){e[n]=t};n<t.length;n++)K(t[n],r);return e},$=function(e,t,n){var r,a;e&&(r=ne.uid(e),H[r]||(H[r]={}),a=C&&e&&e instanceof C,K(t.split(/\s+/),function(t){R&&!a?R.event.add(e,t,n):(H[r][t]||(H[r][t]=[]),H[r][t].push(n),e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)}))},Y=function(e,t,n){var r,a,o;e&&(r=ne.uid(e),a=H[r]||{},o=C&&e&&e instanceof C,K(t.split(/\s+/),function(t){if(R&&!o)R.event.remove(e,t,n);else{for(var r=a[t]||[],i=r.length;i--;)if(r[i]===n){r.splice(i,1);break}e.addEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}}))},Z=function(e,t,n){$(e,t,function r(a){Y(e,t,r),n(a)})},ee=function(t){return t.target||(t.target=e.event&&e.event.srcElement||y),3===t.target.nodeType&&(t.target=t.target.parentNode),t},te=function(e){var t=y.createElement("input");return t.setAttribute("type","file"),e in t},ne={version:"2.0.19",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(e,t){return e+(null!=t?"["+t+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:z(1),MB:z(2),GB:z(3),TB:z(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(e){return e?e[ne.expando]=e[ne.expando]||ne.uid():(++m,ne.expando+m)},log:function(){ne.debug&&d&&(h?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,t){var n=y.createElement("img");return t&&ne.event.one(n,"error load",function(e){t("error"==e.type,n),n=null}),n.src=e,n},getXHR:function(){var t;if(E)t=new E;else if(e.ActiveXObject)try{t=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(n){t=new ActiveXObject("Microsoft.XMLHTTP")}return t},isArray:J,support:{dnd:k&&"ondrop"in y.createElement("div"),cors:k,html5:P,chunked:O,dataURI:!0,accept:te("accept"),multiple:te("multiple")},event:{on:$,off:Y,one:Z,fix:ee},throttle:function(t,n){var r,a;return function(){a=arguments,r||(t.apply(e,a),r=setTimeout(function(){r=0,t.apply(e,a)},n))}},F:function(){},parseJSON:function(t){var n;return n=e.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(e){return e=String(e),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},defer:function(){var e,n,r=[],a={resolve:function(t,o){for(a.resolve=g,n=t||!1,e=o;o=r.shift();)o(n,e)},then:function(a){n!==t?a(n,e):r.push(a)}};return a},queue:function(e){var t=0,n=0,r=!1,a=!1,o={inc:function(){n++},next:function(){t++,setTimeout(o.check,0)},check:function(){t>=n&&!r&&o.end()},isFail:function(){return r},fail:function(){!r&&e(r=!0)},end:function(){a||(a=!0,e())}};return o},each:K,afor:function(e,t){var n=0,r=e.length;J(e)&&r--?!function a(){t(r!=n&&a,e[n],n++)}():t(!1)},extend:Q,isFile:function(e){return"[object File]"===L.call(e)},isBlob:function(e){return this.isFile(e)||"[object Blob]"===L.call(e)},isCanvas:function(e){return e&&j.test(e.nodeName)},getFilesFilter:function(e){return e="string"==typeof e?e:e.getAttribute&&e.getAttribute("accept")||"",e?new RegExp("("+e.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(e,t){ne.isCanvas(e)?n(e,t,"load",ne.toDataURL(e)):a(e,t,"DataURL")},readAsBinaryString:function(e,t){r("BinaryString")?a(e,t,"BinaryString"):a(e,function(e){if("load"==e.type)try{e.result=ne.toBinaryString(e.result)}catch(n){e.type="error",e.message=n.toString()}t(e)},"DataURL")},readAsArrayBuffer:function(e,t){a(e,t,"ArrayBuffer")},readAsText:function(e,t,n){n||(n=t,t="utf-8"),a(e,n,"Text",t)},toDataURL:function(e,t){return"string"==typeof e?e:e.toDataURL?e.toDataURL(t||"image/png"):void 0},toBinaryString:function(t){return e.atob(ne.toDataURL(t).replace(N,""))},readAsImage:function(e,r,a){var o,i,s;ne.isBlob(e)?A?(o=A.createObjectURL(e),o===t?n(e,r,"error"):ne.readAsImage(o,r,a)):ne.readAsDataURL(e,function(t){"load"==t.type?ne.readAsImage(t.result,r,a):(a||"error"==t.type)&&n(e,r,t,null,{loaded:t.loaded,total:t.total})}):ne.isCanvas(e)?n(e,r,"load",e):U.test(e.nodeName)?e.complete?n(e,r,"load",e):(i="error abort load",Z(e,i,function l(t){"load"==t.type&&A&&A.revokeObjectURL(e.src),Y(e,i,l),n(e,r,t,e)})):e.iframe?n(e,r,{type:"error"}):(s=ne.newImage(e.dataURL||e),ne.readAsImage(s,r,a))},checkFileObj:function(e){var t={},n=ne.accept;return"object"==typeof e?t=e:t.name=(e+"").split(/\\|\//g).pop(),null==t.type&&(t.type=t.name.split(".").pop()),K(n,function(e,n){e=new RegExp(e.replace(/\s/g,"|"),"i"),(e.test(t.type)||ne.ext2mime[t.type])&&(t.type=ne.ext2mime[t.type]||n.split("/")[0]+"/"+t.type)}),t},getDropFiles:function(e,t){var n,r,a,u,c=[],p=[],d=f(e),h=d.files,m=d.items,g=J(m)&&m[0]&&s(m[0]),y=ne.queue(function(){t(c,p)});if(g)if(_&&h)for(r=h.length,n=new Array(r);r--;){a=h[r];try{u=s(m[r])}catch(v){ne.log("[err] getDropFiles: ",v),u=null}i(u)&&(u.isDirectory||u.isFile&&a.name==a.name.normalize("NFC"))?n[r]=u:n[r]=a}else n=m;else n=h;K(n||[],function(e){y.inc();try{g&&i(e)?l(e,function(e,t,n){e?ne.log("[err] getDropFiles:",e):c.push.apply(c,t),p.push.apply(p,n),y.next()}):o(e,function(t,n){t?c.push(e):e.error=n,p.push(e),y.next()})}catch(t){y.next(),ne.log("[err] getDropFiles: ",t)}}),y.check()},getFiles:function(e,t,n){var r=[];return n?(ne.filterFiles(ne.getFiles(e),t,n),null):(e.jquery&&(e.each(function(){r=r.concat(ne.getFiles(this))}),e=r,r=[]),"string"==typeof t&&(t=ne.getFilesFilter(t)),e.originalEvent?e=ee(e.originalEvent):e.srcElement&&(e=ee(e)),e.dataTransfer?e=e.dataTransfer:e.target&&(e=e.target),e.files?(r=e.files,P||(r[0].blob=e,r[0].iframe=!0)):!P&&c(e)?ne.trim(e.value)&&(r=[ne.checkFileObj(e.value)],r[0].blob=e,r[0].iframe=!0):J(e)&&(r=e),ne.filter(r,function(e){return!t||t.test(e.name)}))},getTotalSize:function(e){for(var t=0,n=e&&e.length;n--;)t+=e[n].size;return t},getInfo:function(e,t){var n={},r=q.concat();ne.isBlob(e)?!function a(){var o=r.shift();o?o.test(e.type)?o(e,function(e,r){e?t(e):(Q(n,r),a())}):a():t(!1,n)}():t("not_support_info",n)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},q.push(t)},filter:function(e,t){for(var n,r=[],a=0,o=e.length;o>a;a++)a in e&&(n=e[a],t.call(n,n,a,e)&&r.push(n));return r},filterFiles:function(e,t,n){if(e.length){var r,a=e.concat(),o=[],i=[];!function s(){a.length?(r=a.shift(),ne.getInfo(r,function(e,n){(t(r,e?!1:n)?o:i).push(r),s()})):n(o,i)}()}else n([],e)},upload:function(e){e=Q({jsonp:"callback",prepare:ne.F,beforeupload:ne.F,upload:ne.F,fileupload:ne.F,fileprogress:ne.F,filecomplete:ne.F,progress:ne.F,complete:ne.F,pause:ne.F,imageOriginal:!0,chunkSize:ne.chunkSize,chunkUploadRetry:ne.chunkUploadRetry,uploadRetry:ne.uploadRetry},e),e.imageAutoOrientation&&!e.imageTransform&&(e.imageTransform={rotate:"auto"});var t,n=new ne.XHR(e),r=this._getFilesDataArray(e.files),a=this,o=0,i=0,s=!1;return K(r,function(e){o+=e.size}),n.files=[],K(r,function(e){n.files.push(e.file)}),n.total=o,n.loaded=0,n.filesLeft=r.length,e.beforeupload(n,e),t=function(){var l,c=r.shift(),f=c&&c.file,p=!1,d=u(e);if(n.filesLeft=r.length,f&&f.name===ne.expando&&(f=null,ne.log("[warn] FileAPI.upload() — called without files")),("abort"!=n.statusText||n.current)&&c){if(s=!1,n.currentFile=f,f&&e.prepare(f,d)===!1)return void t.call(a);d.file=f,a._getFormData(d,c,function(s){i||e.upload(n,e);var l=new ne.XHR(Q({},d,{upload:f?function(){e.fileupload(f,l,d)}:g,progress:f?function(t){p||(p=t.loaded===t.total,e.fileprogress({type:"progress",total:c.total=t.total,loaded:c.loaded=t.loaded},f,l,d),e.progress({type:"progress",total:o,loaded:n.loaded=i+c.size*(t.loaded/t.total)||0},f,l,d))}:g,complete:function(r){K(W,function(e){n[e]=l[e]}),f&&(c.total=c.total||c.size,c.loaded=c.total,r||(this.progress(c),p=!0,i+=c.size,n.loaded=i),e.filecomplete(r,l,f,d)),setTimeout(function(){t.call(a)},0)}}));n.abort=function(e){e||(r.length=0),this.current=e,l.abort()},l.send(s)})}else l=200==n.status||201==n.status||204==n.status,e.complete(l?!1:n.statusText||"error",n,e),s=!0},setTimeout(t,0),n.append=function(e,i){e=ne._getFilesDataArray([].concat(e)),K(e,function(e){o+=e.size,n.files.push(e.file),i?r.unshift(e):r.push(e)}),n.statusText="",s&&t.call(a)},n.remove=function(e){for(var t,n=r.length;n--;)r[n].file==e&&(t=r.splice(n,1),o-=t.size);return t},n},_getFilesDataArray:function(e){var t,n=[],r={};return c(e)?(t=ne.getFiles(e),r[e.name||"file"]=null!==e.getAttribute("multiple")?t:t[0]):J(e)&&c(e[0])?K(e,function(e){r[e.name||"file"]=ne.getFiles(e)}):r=e,K(r,function a(e,t){J(e)?K(e,function(e){a(e,t)}):e&&(e.name||e.image)&&n.push({name:t,file:e,size:e.size,total:e.size,loaded:0})}),n.length||n.push({file:{name:ne.expando}}),n},_getFormData:function(e,t,n){var r=t.file,a=t.name,o=r.name,i=r.type,s=ne.support.transform&&e.imageTransform,l=new ne.Form,u=ne.queue(function(){n(l)}),c=s&&p(s),f=ne.postNameConcat;K(e.data,function d(e,t){"object"==typeof e?K(e,function(e,n){d(e,f(t,n))}):l.append(t,e)}),function h(t){t.image?(u.inc(),t.toData(function(e,n){t.file&&(n.type=t.file.type,n.quality=t.matrix.quality,o=t.file&&t.file.name),o=o||(new Date).getTime()+".png",h(n),u.next()})):ne.Image&&s&&(/^image/.test(t.type)||D.test(t.nodeName))?(u.inc(),c&&(s=[s]),ne.Image.transform(t,s,e.imageAutoOrientation,function(n,r){if(c&&!n)S||ne.flashEngine||(l.multipart=!0),l.append(a,r[0],o,s[0].type||i);else{var p=0;n||K(r,function(e,t){S||ne.flashEngine||(l.multipart=!0),s[t].postName||(p=1),l.append(s[t].postName||f(a,t),e,o,s[t].type||i)}),(n||e.imageOriginal)&&l.append(f(a,p?"original":null),t,o,i)}u.next()})):o!==ne.expando&&l.append(a,t,o)}(r),u.check()},reset:function(e,t){var n,r;return R?(r=R(e).clone(!0).insertBefore(e).val("")[0],t||R(e).remove()):(n=e.parentNode,r=n.insertBefore(e.cloneNode(!0),e),r.value="",t||n.removeChild(e),K(H[ne.uid(e)],function(t,n){K(t,function(t){Y(e,n,t),$(r,n,t)})})),r},load:function(e,t){var n=ne.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),$(n,"progress",function(e){e.lengthComputable&&t({type:e.type,loaded:e.loaded,total:e.total},n)}),n.onreadystatechange=function(){if(4==n.readyState)if(n.onreadystatechange=null,200==n.status){e=e.split("/");var r={name:e[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")};r.dataURL="data:"+r.type+";base64,"+ne.encode64(n.responseBody||n.responseText),t({type:"load",result:r},n)}else t({type:"error"},n)},n.send(null)):t({type:"error"}),n},encode64:function(e){var t,n,r,a,o,i,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;for("string"!=typeof e&&(e=String(e));c<e.length;)t=255&e.charCodeAt(c++),n=255&e.charCodeAt(c++),r=255&e.charCodeAt(c++),a=t>>2,o=(3&t)<<4|n>>4,isNaN(n)?i=s=64:(i=(15&n)<<2|r>>6,s=isNaN(r)?64:63&r),u+=l.charAt(a)+l.charAt(o)+l.charAt(i)+l.charAt(s);return u}};ne.addInfoReader(/^image/,function(e,t){if(!e.__dimensions){var n=e.__dimensions=ne.defer();ne.readAsImage(e,function(e){var t=e.target;n.resolve("load"==e.type?!1:"error",{width:t.width,height:t.height}),t.src=ne.EMPTY_PNG,t=null})}e.__dimensions.then(t)}),ne.event.dnd=function(e,t,n){var r,a;n||(n=t,t=ne.F),C?($(e,"dragenter dragleave dragover",t.ff=t.ff||function(e){for(var n=f(e).types,o=n&&n.length,i=!1;o--;)if(~n[o].indexOf("File")){e[V](),a!==e.type&&(a=e.type,"dragleave"!=a&&t.call(e[G],!0,e),i=!0);break}i&&(clearTimeout(r),r=setTimeout(function(){t.call(e[G],"dragleave"!=a,e)},50))}),$(e,"drop",n.ff=n.ff||function(e){e[V](),a=0,t.call(e[G],!1,e),ne.getDropFiles(e,function(t,r){n.call(e[G],t,r,e)})})):ne.log("Drag'n'Drop -- not supported")},ne.event.dnd.off=function(e,t,n){Y(e,"dragenter dragleave dragover",t.ff),Y(e,"drop",n.ff)},R&&!R.fn.dnd&&(R.fn.dnd=function(e,t){return this.each(function(){ne.event.dnd(this,e,t)})},R.fn.offdnd=function(e,t){return this.each(function(){ne.event.dnd.off(this,e,t)})}),e.FileAPI=Q(ne,e.FileAPI),ne.log("FileAPI: "+ne.version),ne.log("protocol: "+e.location.protocol),ne.log("doctype: ["+v.name+"] "+v.publicId+" "+v.systemId),K(y.getElementsByTagName("meta"),function(e){/x-ua-compatible/i.test(e.getAttribute("http-equiv"))&&ne.log("meta.http-equiv: "+e.getAttribute("content"))});try{d=!!console.log,h=!!console.log.apply}catch(re){}ne.flashUrl||(ne.flashUrl=ne.staticPath+"FileAPI.flash.swf"),ne.flashImageUrl||(ne.flashImageUrl=ne.staticPath+"FileAPI.flash.image.swf"),ne.flashWebcamUrl||(ne.flashWebcamUrl=ne.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(e,t,n){"use strict";function r(t){if(t instanceof r){var n=new r(t.file);return e.extend(n.matrix,t.matrix),n}return this instanceof r?(this.file=t,this.size=t.size||100,void(this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0})):new r(t)}var a=Math.min,o=Math.round,i=function(){return t.createElement("canvas")},s=!1,l={8:270,3:180,6:90,7:270,4:180,5:90};try{s=i().toDataURL("image/png").indexOf("data:image/png")>-1}catch(u){}r.prototype={image:!0,constructor:r,set:function(t){return e.extend(this.matrix,t),this},crop:function(e,t,r,a){return r===n&&(r=e,a=t,e=t=0),this.set({sx:e,sy:t,sw:r,sh:a||r})},resize:function(e,t,n){return/min|max|height|width/.test(t)&&(n=t,t=e),this.set({dw:e,dh:t||e,resize:n})},preview:function(e,t){return this.resize(e,t||e,"preview")},rotate:function(e){return this.set({deg:e})},filter:function(e){return this.set({filter:e})},overlay:function(e){return this.set({overlay:e})},clone:function(){return new r(this)},_load:function(t,n){var r=this;/img|video/i.test(t.nodeName)?n.call(r,null,t):e.readAsImage(t,function(e){n.call(r,"load"!=e.type,e.result)})},_apply:function(t,n){var o,s=i(),l=this.getMatrix(t),u=s.getContext("2d"),c=t.videoWidth||t.width,f=t.videoHeight||t.height,p=l.deg,d=l.dw,h=l.dh,m=c,g=f,y=l.filter,v=t,b=l.overlay,w=e.queue(function(){t.src=e.EMPTY_PNG,n(!1,s)}),x=e.renderImageToCanvas;for(p-=360*Math.floor(p/360),t._type=this.file.type;l.multipass&&a(m/d,g/h)>2;)m=m/2+.5|0,g=g/2+.5|0,o=i(),o.width=m,o.height=g,v!==t?(x(o,v,0,0,v.width,v.height,0,0,m,g),v=o):(v=o,x(v,t,l.sx,l.sy,l.sw,l.sh,0,0,m,g),l.sx=l.sy=l.sw=l.sh=0);s.width=p%180?h:d,s.height=p%180?d:h,s.type=l.type,s.quality=l.quality,u.rotate(p*Math.PI/180),x(u.canvas,v,l.sx,l.sy,l.sw||v.width,l.sh||v.height,180==p||270==p?-d:0,90==p||180==p?-h:0,d,h),d=s.width,h=s.height,b&&e.each([].concat(b),function(t){w.inc();var n=new window.Image,r=function(){var a=0|t.x,o=0|t.y,i=t.w||n.width,s=t.h||n.height,l=t.rel;a=1==l||4==l||7==l?(d-i+a)/2:2==l||5==l||8==l?d-(i+a):a,o=3==l||4==l||5==l?(h-s+o)/2:l>=6?h-(s+o):o,e.event.off(n,"error load abort",r);try{u.globalAlpha=t.opacity||1,u.drawImage(n,a,o,i,s)}catch(c){}w.next()};e.event.on(n,"error load abort",r),n.src=t.src,n.complete&&r()}),y&&(w.inc(),r.applyFilter(s,y,w.next)),w.check()},getMatrix:function(t){var n,r,i=e.extend({},this.matrix),s=i.sw=i.sw||t.videoWidth||t.naturalWidth||t.width,l=i.sh=i.sh||t.videoHeight||t.naturalHeight||t.height,u=i.dw=i.dw||s,c=i.dh=i.dh||l,f=s/l,p=u/c,d=i.resize;return"preview"==d?u==s&&c==l||(p>=f?(n=s,r=n/p):(r=l,n=r*p),n==s&&r==l||(i.sx=~~((s-n)/2),i.sy=~~((l-r)/2),s=n,l=r)):"height"==d?u=c*f:"width"==d?c=u/f:d&&(s>u||l>c?"min"==d?(u=o(p>f?a(s,u):c*f),c=o(p>f?u/f:a(l,c))):(u=o(f>=p?a(s,u):c*f),c=o(f>=p?u/f:a(l,c))):(u=s,c=l)),i.sw=s,i.sh=l,i.dw=u,i.dh=c,i.multipass=e.multiPassResize,i},_trans:function(t){this._load(this.file,function(n,r){if(n)t(n);else try{this._apply(r,t)}catch(n){e.log("[err] FileAPI.Image.fn._apply:",n),t(n)}})},get:function(t){if(e.support.transform){var n=this,r=n.matrix;"auto"==r.deg?e.getInfo(n.file,function(e,a){r.deg=l[a&&a.exif&&a.exif.Orientation]||0,n._trans(t)}):n._trans(t)}else t("not_support_transform");return this},toData:function(e){return this.get(e)}},r.exifOrientation=l,r.transform=function(t,a,o,i){function s(s,l){var u={},c=e.queue(function(e){i(e,u)});s?c.fail():e.each(a,function(e,a){var i,s,f;c.isFail()||(i=new r(l.nodeType?l:t),s="function"==typeof e,s?e(l,i):e.width?i[e.preview?"preview":"resize"](e.width,e.height,e.strategy):e.maxWidth&&(l.width>e.maxWidth||l.height>e.maxHeight)&&i.resize(e.maxWidth,e.maxHeight,"max"),e.crop&&(f=e.crop,i.crop(0|f.x,0|f.y,f.w||f.width,f.h||f.height)),e.rotate===n&&o&&(e.rotate="auto"),i.set({type:i.matrix.type||e.type||t.type||"image/png"}),s||i.set({deg:e.rotate,overlay:e.overlay,filter:e.filter,quality:e.quality||1}),c.inc(),i.toData(function(e,t){e?c.fail():(u[a]=t,c.next())}))})}t.width?s(!1,t):e.getInfo(t,s)},e.each(["TOP","CENTER","BOTTOM"],function(t,n){e.each(["LEFT","CENTER","RIGHT"],function(e,a){r[t+"_"+e]=3*n+a,r[e+"_"+t]=3*n+a})}),r.toCanvas=function(e){var n=t.createElement("canvas");return n.width=e.videoWidth||e.width,n.height=e.videoHeight||e.height,n.getContext("2d").drawImage(e,0,0),n},r.fromDataURL=function(t,n,r){var a=e.newImage(t);e.extend(a,n),r(a)},r.applyFilter=function(t,n,a){"function"==typeof n?n(t,a):window.Caman&&window.Caman("IMG"==t.tagName?r.toCanvas(t):t,function(){"string"==typeof n?this[n]():e.each(n,function(e,t){this[t](e)},this),this.render(a)})},e.renderImageToCanvas=function(t,n,r,a,o,i,s,l,u,c){try{return t.getContext("2d").drawImage(n,r,a,o,i,s,l,u,c)}catch(f){throw e.log("renderImageToCanvas failed"),f}},e.support.canvas=e.support.transform=s,e.Image=r}(FileAPI,document),function(e){"use strict";e(FileAPI)}(function(e){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var t=e.renderImageToCanvas;e.detectSubsampling=function(e){var t,n;return e.width*e.height>1048576?(t=document.createElement("canvas"),t.width=t.height=1,n=t.getContext("2d"),n.drawImage(e,-e.width+1,0),0===n.getImageData(0,0,1,1).data[3]):!1},e.detectVerticalSquash=function(e,t){var n,r,a,o,i,s=e.naturalHeight||e.height,l=document.createElement("canvas"),u=l.getContext("2d");for(t&&(s/=2),l.width=1,l.height=s,u.drawImage(e,0,0),n=u.getImageData(0,0,1,s).data,r=0,a=s,o=s;o>r;)i=n[4*(o-1)+3],0===i?a=o:r=o,o=a+r>>1;return o/s||1},e.renderImageToCanvas=function(n,r,a,o,i,s,l,u,c,f){if("image/jpeg"===r._type){var p,d,h,m,g=n.getContext("2d"),y=document.createElement("canvas"),v=1024,b=y.getContext("2d");if(y.width=v,y.height=v,g.save(),p=e.detectSubsampling(r),p&&(a/=2,o/=2,i/=2,s/=2),d=e.detectVerticalSquash(r,p),p||1!==d){for(o*=d,c=Math.ceil(v*c/i),f=Math.ceil(v*f/s/d),u=0,m=0;s>m;){for(l=0,h=0;i>h;)b.clearRect(0,0,v,v),b.drawImage(r,a,o,i,s,-h,-m,i,s),g.drawImage(y,0,0,v,v,l,u,c,f),h+=v,l+=c;m+=v,u+=f}return g.restore(),n}}return t(n,r,a,o,i,s,l,u,c,f)}}}),function(e,t){"use strict";function n(t,n,r){var a,o,i,s,l=t.blob,u=t.file;if(u){if(!l.toDataURL)return void e.readAsBinaryString(l,function(e){"load"==e.type&&n(t,e.result)});a={"image/jpeg":".jpe?g","image/png":".png"},o=a[t.type]?t.type:"image/png",i=a[o]||".png",s=l.quality||1,u.match(new RegExp(i+"$","i"))||(u+=i.replace("?","")),t.file=u,t.type=o,!r&&l.toBlob?l.toBlob(function(e){n(t,e)},o,s):n(t,e.toBinaryString(l.toDataURL(o,s)))}else n(t,l)}var r=t.document,a=t.FormData,o=function(){this.items=[]},i=t.encodeURIComponent;o.prototype={append:function(e,t,n,r){this.items.push({name:e,blob:t&&t.blob||(void 0==t?"":t),file:t&&(n||t.name),type:t&&(r||t.type)})},each:function(e){for(var t=0,n=this.items.length;n>t;t++)e.call(this,this.items[t])},toData:function(t,n){n._chunked=e.support.chunked&&n.chunkSize>0&&1==e.filter(this.items,function(e){return e.file}).length,e.support.html5?e.formData&&!this.multipart&&a?n._chunked?(e.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(e.log("FileAPI.Form.toFormData"),this.toFormData(t)):(e.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(e.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(t,n,r,a){var o=e.queue(function(){n(t)});this.each(function(i){try{r(i,t,o,a)}catch(s){e.log("FileAPI.Form._to: "+s.message),n(s)}}),o.check()},toHtmlData:function(t){this._to(r.createDocumentFragment(),t,function(t,n){var a,o=t.blob;t.file?(e.reset(o,!0),o.name=t.name,o.disabled=!1,n.appendChild(o)):(a=r.createElement("input"),a.name=t.name,a.type="hidden",a.value=o,n.appendChild(a))})},toPlainData:function(e){this._to({},e,function(e,t,r){e.file&&(t.type=e.file),e.blob.toBlob?(r.inc(),n(e,function(e,n){t.name=e.name,t.file=n,t.size=n.length,t.type=e.type,r.next()})):e.file?(t.name=e.blob.name,t.file=e.blob,t.size=e.blob.size,t.type=e.type):(t.params||(t.params=[]),t.params.push(i(e.name)+"="+i(e.blob))),t.start=-1,t.end=t.file&&t.file.FileAPIReadPosition||-1,t.retry=0})},toFormData:function(e){this._to(new a,e,function(e,t,r){e.blob&&e.blob.toBlob?(r.inc(),n(e,function(e,n){t.append(e.name,n,e.file),r.next()})):e.file?t.append(e.name,e.blob,e.file):t.append(e.name,e.blob),e.file&&t.append("_"+e.name,e.file)})},toMultipartData:function(t){this._to([],t,function(e,t,r,a){r.inc(),n(e,function(e,n){t.push("--_"+a+('\r\nContent-Disposition: form-data; name="'+e.name+'"'+(e.file?'; filename="'+i(e.file)+'"':"")+(e.file?"\r\nContent-Type: "+(e.type||"application/octet-stream"):"")+"\r\n\r\n"+(e.file?n:i(n))+"\r\n")),r.next()},!0)},e.expando)}},e.Form=o}(FileAPI,window),function(e,t){"use strict";var n=function(){},r=e.document,a=function(e){this.uid=t.uid(),this.xhr={abort:n,getResponseHeader:n,getAllResponseHeaders:n},this.options=e},o={"":1,XML:1,Text:1,Body:1};a.prototype={status:0,statusText:"",constructor:a,getResponseHeader:function(e){return this.xhr.getResponseHeader(e)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(r,a){var o=this,i=o.options;o.end=o.abort=n,o.status=r,a&&(o.statusText=a),t.log("xhr.end:",r,a),i.complete(200==r||201==r?!1:o.statusText||"unknown",o),o.xhr&&o.xhr.node&&setTimeout(function(){var t=o.xhr.node;try{t.parentNode.removeChild(t)}catch(n){}try{delete e[o.uid]}catch(n){}e[o.uid]=o.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var t=this,n=this.options;e.toData(function(e){e instanceof Error?t.end(0,e.message):(n.upload(n,t),t._send.call(t,n,e))},n)},_send:function(n,a){var i,s,l,u,c,f,p,d,h,m,g=this,y=g.uid,v=g.uid+"Load",b=n.url;if(t.log("XHR._send:",a),n.cache||(b+=(~b.indexOf("?")?"&":"?")+t.uid()),a.nodeName){s=n.jsonp,b=b.replace(/([a-z]+)=(\?)/i,"$1="+y),n.upload(n,g),l=function(e){if(~b.indexOf(e.origin))try{var n=t.parseJSON(e.data);n.id==y&&u(n.status,n.statusText,n.response)}catch(r){u(0,r.message)}},u=e[y]=function(n,r,a){g.readyState=4,g.responseText=a,g.end(n,r),t.event.off(e,"message",l),e[y]=i=f=e[v]=null},g.xhr.abort=function(){try{f.stop?f.stop():f.contentWindow.stop?f.contentWindow.stop():f.contentWindow.document.execCommand("Stop")}catch(e){}u(0,"abort")},t.event.on(e,"message",l),e[v]=function(){try{var e=f.contentWindow,n=e.document,r=e.result||t.parseJSON(n.body.innerHTML);u(r.status,r.statusText,r.response)}catch(a){t.log("[transport.onload]",a)}},i=r.createElement("div"),i.innerHTML='<form target="'+y+'" action="'+b+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+y+'" src="javascript:false;" onload="window.'+v+" && "+v+'();"></iframe>'+(s&&n.url.indexOf("=?")<0?'<input value="'+y+'" name="'+s+'" type="hidden"/>':"")+"</form>",c=i.getElementsByTagName("form")[0],f=i.getElementsByTagName("iframe")[0],c.appendChild(a),t.log(c.parentNode.innerHTML),r.body.appendChild(i),g.xhr.node=i,g.readyState=2;try{c.submit()}catch(w){t.log("iframe.error: "+w)}c=null}else{if(b=b.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted)return void t.log("Error: already aborted");i=g.xhr=t.getXHR(),a.params&&(b+=(b.indexOf("?")<0?"?":"&")+a.params.join("&")),i.open("POST",b,!0),t.withCredentials&&(i.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||i.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.each(n.headers,function(e,t){i.setRequestHeader(t,e)}),n._chunked?(i.upload&&i.upload.addEventListener("progress",t.throttle(function(e){a.retry||n.progress({type:e.type,total:a.size,loaded:a.start+e.loaded,totalSize:a.size},g,n)},100),!1),i.onreadystatechange=function(){var e,r,s=parseInt(i.getResponseHeader("X-Last-Known-Byte"),10);if(g.status=i.status,g.statusText=i.statusText,g.readyState=i.readyState,4==i.readyState){for(e in o)g["response"+e]=i["response"+e];i.onreadystatechange=null,!i.status||i.status-201>0?(t.log("Error: "+i.status),(!i.status&&!i.aborted||500==i.status||416==i.status)&&++a.retry<=n.chunkUploadRetry?(r=i.status?0:t.chunkNetworkDownRetryTimeout,n.pause(a.file,n),t.log("X-Last-Known-Byte: "+s),s?a.end=s:(a.end=a.start-1,416==i.status&&(a.end=a.end-n.chunkSize)),setTimeout(function(){g._send(n,a)},r)):g.end(i.status)):(a.retry=0,a.end==a.size-1?g.end(i.status):(t.log("X-Last-Known-Byte: "+s),s&&(a.end=s),a.file.FileAPIReadPosition=a.end,setTimeout(function(){g._send(n,a)},0))),i=null}},a.start=a.end+1,a.end=Math.max(Math.min(a.start+n.chunkSize,a.size)-1,a.start),p=a.file,d=(p.slice||p.mozSlice||p.webkitSlice).call(p,a.start,a.end+1),a.size&&!d.size?setTimeout(function(){g.end(-1)}):(i.setRequestHeader("Content-Range","bytes "+a.start+"-"+a.end+"/"+a.size),i.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(a.name)),i.setRequestHeader("Content-Type",a.type||"application/octet-stream"),i.send(d)),p=d=null):(i.upload&&i.upload.addEventListener("progress",t.throttle(function(e){n.progress(e,g,n)},100),!1),i.onreadystatechange=function(){var e,r;if(g.status=i.status,g.statusText=i.statusText,g.readyState=i.readyState,4==i.readyState){for(e in o)g["response"+e]=i["response"+e];i.onreadystatechange=null,!i.status||i.status>201?(t.log("Error: "+i.status),(!i.status&&!i.aborted||500==i.status)&&(n.retry||0)<n.uploadRetry?(n.retry=(n.retry||0)+1,r=t.networkDownRetryTimeout,n.pause(n.file,n),setTimeout(function(){g._send(n,a)},r)):g.end(i.status)):g.end(i.status),i=null}},t.isArray(a)?(i.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+t.expando),h=a.join("")+"--_"+t.expando+"--",i.sendAsBinary?i.sendAsBinary(h):(m=Array.prototype.map.call(h,function(e){return 255&e.charCodeAt(0)}),i.send(new Uint8Array(m).buffer))):i.send(a))}}},t.XHR=a}(window,FileAPI),function(e,t){"use strict";function n(e){return e>=0?e+"px":e}function r(e){var n,r=s.createElement("canvas"),a=!1;try{n=r.getContext("2d"),n.drawImage(e,0,0,1,1),a=255!=n.getImageData(0,0,1,1).data[4]}catch(o){t.log("[FileAPI.Camera] detectVideoSignal:",o)}return a}var a,o,i=e.URL||e.webkitURL,s=e.document,l=e.navigator,u=l.getUserMedia||l.webkitGetUserMedia||l.mozGetUserMedia||l.msGetUserMedia,c=!!u;t.support.media=c,a=function(e){this.video=e},a.prototype={isActive:function(){return!!this._active},start:function(e){var t,n,a=this,o=a.video,s=function(r){a._active=!r,clearTimeout(n),clearTimeout(t),e&&e(r,a)};u.call(l,{video:!0},function(e){a.stream=e,o.src=i.createObjectURL(e),t=setInterval(function(){r(o)&&s(null)},1e3),n=setTimeout(function(){s("timeout")},5e3),o.play()},s)},stop:function(){try{this._active=!1,this.video.pause();try{this.stream.stop()}catch(e){t.each(this.stream.getTracks(),function(e){
e.stop()})}this.stream=null}catch(e){t.log("[FileAPI.Camera] stop:",e)}},shot:function(){return new o(this.video)}},a.get=function(e){return new a(e.firstChild)},a.publish=function(r,o,i){var l,u;"function"==typeof o&&(i=o,o={}),o=t.extend({},{width:"100%",height:"100%",start:!0},o),r.jquery&&(r=r[0]),l=function(e){if(e)i(e);else{var t=a.get(r);o.start?t.start(i):i(null,t)}},r.style.width=n(o.width),r.style.height=n(o.height),t.html5&&c?(u=s.createElement("video"),u.style.width=n(o.width),u.style.height=n(o.height),e.jQuery?jQuery(r).empty():r.innerHTML="",r.appendChild(u),l()):a.fallback(r,o,l)},a.fallback=function(e,t,n){n("not_support_camera")},o=function(e){var n=e.nodeName?t.Image.toCanvas(e):e,r=t.Image(n);return r.type="image/png",r.width=n.width,r.height=n.height,r.size=n.width*n.height*4,r},a.Shot=o,t.Camera=a}(window,FileAPI),function(e,t,n){"use strict";var r=e.document,a=e.location,o=e.navigator,i=n.each;n.support.flash=function(){var t=o.mimeTypes,r=!1;if(o.plugins&&"object"==typeof o.plugins["Shockwave Flash"])r=o.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{r=!(!e.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(i){n.log("Flash -- does not supported.")}return r&&/^file:/i.test(a)&&n.log("[warn] Flash does not work on `file:` protocol."),r}(),n.support.flash&&(!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function s(e){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(e.width||"100%")+'" height="'+(e.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,n){return e[n]})}function l(e,t){if(e&&e.style){var n,r;for(n in t){r=t[n],"number"==typeof r&&(r+="px");try{e.style[n]=r}catch(a){}}}}function u(e,t){i(t,function(t,n){var r=e[n];e[n]=function(){return this.parent=r,t.apply(this,arguments)}})}function c(e){return e&&!e.flashId}function f(e){var t=e.wid=n.uid();return x._fn[t]=e,"FileAPI.Flash._fn."+t}function p(e){try{x._fn[e.wid]=null,delete x._fn[e.wid]}catch(t){}}function d(e,t){if(!w.test(e)){if(/^\.\//.test(e)||"/"!=e.charAt(0)){var n=a.pathname;n=n.substr(0,n.lastIndexOf("/")),e=(n+"/"+e).replace("/./","/")}"//"!=e.substr(0,2)&&(e="//"+a.host+e),w.test(e)||(e=a.protocol+e)}return t&&(e+=(/\?/.test(e)?"&":"?")+t),e}function h(e,t,a){function o(){try{var e=x.get(u);e.setImage(t)}catch(r){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',r)}}var i,u=n.uid(),c=r.createElement("div"),h=10;for(i in e)c.setAttribute(i,e[i]),c[i]=e[i];l(c,e),e.width="100%",e.height="100%",c.innerHTML=s(n.extend({id:u,src:d(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+e.scale+"&callback="+f(function m(){return p(m),--h>0&&o(),!0})},e)),a(!1,c),c=null}function m(e){return{id:e.id,name:e.name,matrix:e.matrix,flashId:e.flashId}}function g(t){var n=t.getBoundingClientRect(),a=r.body,o=(t&&t.ownerDocument).documentElement;return{top:n.top+(e.pageYOffset||o.scrollTop)-(o.clientTop||a.clientTop||0),left:n.left+(e.pageXOffset||o.scrollLeft)-(o.clientLeft||a.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top}}var y=n.uid(),v=0,b={},w=/^https?:/i,x={_fn:{},init:function(){var e,t=r.body&&r.body.firstChild;if(t)do if(1==t.nodeType)return n.log("FlashAPI.state: awaiting"),e=r.createElement("div"),e.id="_"+y,l(e,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),t.parentNode.insertBefore(e,t),void x.publish(e,y);while(t=t.nextSibling);10>v&&setTimeout(x.init,50*++v)},publish:function(e,t,r){r=r||{},e.innerHTML=s({id:t,src:d(n.flashUrl,"r="+n.version),wmode:r.camera?"":"transparent",flashvars:"callback="+(r.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+t+"&storeKey="+o.userAgent.match(/\d/gi).join("")+"_"+n.version+(x.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(r.camera?"&useCamera="+d(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},r)},ready:function(){n.log("FlashAPI.state: ready"),x.ready=n.F,x.isReady=!0,x.patch(),x.patchCamera&&x.patchCamera(),n.event.on(r,"mouseover",x.mouseover),n.event.on(r,"click",function(e){x.mouseover(e)&&(e.preventDefault?e.preventDefault():e.returnValue=!0)})},getEl:function(){return r.getElementById("_"+y)},getWrapper:function(e){do if(/js-fileapi-wrapper/.test(e.className))return e;while((e=e.parentNode)&&e!==r.body)},mouseover:function(e){var t,a,o,i,s=n.event.fix(e).target;if(/input/i.test(s.nodeName)&&"file"==s.type&&!s.disabled){if(t=s.getAttribute(y),a=x.getWrapper(s),n.multiFlash){if("i"==t||"r"==t)return!1;if("p"!=t){if(s.setAttribute(y,"i"),o=r.createElement("div"),!a)return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");l(o,{top:0,left:0,width:s.offsetWidth,height:s.offsetHeight,zIndex:"2147483647",position:"absolute"}),a.appendChild(o),x.publish(o,n.uid()),s.setAttribute(y,"p")}return!0}a&&(i=g(a),l(x.getEl(),i),x.curInp=s)}else/object|embed/i.test(s.nodeName)||l(x.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(e){var t=e.type;if("ready"==t){try{x.getInput(e.flashId).setAttribute(y,"r")}catch(r){}return x.ready(),setTimeout(function(){x.mouseenter(e)},50),!0}"ping"===t?n.log("(flash -> js).ping:",[e.status,e.savedStatus],e.error):"log"===t?n.log("(flash -> js).log:",e.target):t in x&&setTimeout(function(){n.log("FlashAPI.event."+e.type+":",e),x[t](e)},1)},mouseenter:function(e){var t,r,a=x.getInput(e.flashId);a&&(x.cmd(e,"multiple",null!=a.getAttribute("multiple")),t=[],r={},i((a.getAttribute("accept")||"").split(/,\s*/),function(e){n.accept[e]&&i(n.accept[e].split(" "),function(e){r[e]=1})}),i(r,function(e,n){t.push(n)}),x.cmd(e,"accept",t.length?t.join(",")+","+t.join(",").toUpperCase():"*"))},get:function(t){return r[t]||e[t]||r.embeds[t]},getInput:function(e){if(!n.multiFlash)return x.curInp;try{var t=x.getWrapper(x.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(r){n.log('[err] Can not find "input" by flashId:',e,r)}},select:function(e){var a,o=x.getInput(e.flashId),s=n.uid(o),l=e.target.files;i(l,function(e){n.checkFileObj(e)}),b[s]=l,r.createEvent?(a=r.createEvent("Event"),a.files=l,a.initEvent("change",!0,!0),o.dispatchEvent(a)):t?t(o).trigger({type:"change",files:l}):(a=r.createEventObject(),a.files=l,o.fireEvent("onchange",a))},cmd:function(e,t,r,a){try{return n.log("(js -> flash)."+t+":",r),x.get(e.flashId||e).cmd(t,r)}catch(o){n.log("(js -> flash).onError:",o.toString()),a||setTimeout(function(){x.cmd(e,t,r,!0)},50)}},patch:function(){n.flashEngine=!0,u(n,{getFiles:function(e,t,r){if(r)return n.filterFiles(n.getFiles(e),t,r),null;var a=n.isArray(e)?e:b[n.uid(e.target||e.srcElement||e)];return a?(t&&(t=n.getFilesFilter(t),a=n.filter(a,function(e){return t.test(e.name)})),a):this.parent.apply(this,arguments)},getInfo:function(e,t){if(c(e))this.parent.apply(this,arguments);else if(e.isShot)t(null,e.info={width:e.width,height:e.height});else{if(!e.__info){var r=e.__info=n.defer();x.cmd(e,"getFileInfo",{id:e.id,callback:f(function a(t,n){p(a),r.resolve(t,e.info=n)})})}e.__info.then(t)}}}),n.support.transform=!0,n.Image&&u(n.Image.prototype,{get:function(e,t){return this.set({scaleMode:t||"noScale"}),this.parent(e)},_load:function(e,t){if(n.log("FlashAPI.Image._load:",e),c(e))this.parent.apply(this,arguments);else{var r=this;n.getInfo(e,function(n){t.call(r,n,e)})}},_apply:function(e,t){if(n.log("FlashAPI.Image._apply:",e),c(e))this.parent.apply(this,arguments);else{var r=this.getMatrix(e.info),a=t;x.cmd(e,"imageTransform",{id:e.id,matrix:r,callback:f(function o(i,s){n.log("FlashAPI.Image._apply.callback:",i),p(o),i?a(i):n.support.html5||n.support.dataURI&&!(s.length>3e4)?(r.filter&&(a=function(e,a){e?t(e):n.Image.applyFilter(a,r.filter,function(){t(e,this.canvas)})}),n.newImage("data:"+e.type+";base64,"+s,a)):h({width:r.deg%180?r.dh:r.dw,height:r.deg%180?r.dw:r.dh,scale:r.scaleMode},s,a)})})}},toData:function(e){var t=this.file,r=t.info,a=this.getMatrix(r);n.log("FlashAPI.Image.toData"),c(t)?this.parent.apply(this,arguments):("auto"==a.deg&&(a.deg=n.Image.exifOrientation[r&&r.exif&&r.exif.Orientation]||0),e.call(this,!t.info,{id:t.id,flashId:t.flashId,name:t.name,type:t.type,matrix:a}))}}),n.Image&&u(n.Image,{fromDataURL:function(e,t,r){!n.support.dataURI||e.length>3e4?h(n.extend({scale:"exactFit"},t),e.replace(/^data:[^,]+,/,""),function(e,t){r(t)}):this.parent(e,t,r)}}),u(n.Form.prototype,{toData:function(e){for(var t=this.items,r=t.length;r--;)if(t[r].file&&c(t[r].blob))return this.parent.apply(this,arguments);n.log("FlashAPI.Form.toData"),e(t)}}),u(n.XHR.prototype,{_send:function(e,t){var r,a,o,s,l,u;return t.nodeName||t.append&&n.support.html5||n.isArray(t)&&"string"==typeof t[0]?this.parent.apply(this,arguments):(r={},a={},o=this,i(t,function(e){e.file?(a[e.name]=e=m(e.blob),l=e.id,s=e.flashId):r[e.name]=e.blob}),l||(s=y),s?(n.log("FlashAPI.XHR._send: "+s+" -> "+l),o.xhr={headers:{},abort:function(){x.cmd(s,"abort",{id:l})},getResponseHeader:function(e){return this.headers[e]},getAllResponseHeaders:function(){return this.headers}},u=n.queue(function(){x.cmd(s,"upload",{url:d(e.url.replace(/([a-z]+)=(\?)&?/i,"")),data:r,files:l?a:null,headers:e.headers||{},callback:f(function t(r){var a=r.type,i=r.result;n.log("FlashAPI.upload."+a),"progress"==a?(r.loaded=Math.min(r.loaded,r.total),r.lengthComputable=!0,e.progress(r)):"complete"==a?(p(t),"string"==typeof i&&(o.responseText=i.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),o.end(r.status||200)):"abort"!=a&&"error"!=a||(o.end(r.status||0,r.message),p(t))})})}),i(a,function(e){u.inc(),n.getInfo(e,u.next)}),void u.check()):(n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments)))}})}};n.Flash=x,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(e,t){n.support.dataURI=!(1!=t.width||1!=t.height),x.init()})}()}(window,window.jQuery,FileAPI),function(e,t,n){"use strict";var r=n.each,a=[];!n.support.flash||!n.media||n.support.media&&n.html5||!function(){function e(e){var t=e.wid=n.uid();return n.Flash._fn[t]=e,"FileAPI.Flash._fn."+t}function t(e){try{n.Flash._fn[e.wid]=null,delete n.Flash._fn[e.wid]}catch(t){}}var o=n.Flash;n.extend(n.Flash,{patchCamera:function(){n.Camera.fallback=function(r,a,i){var s=n.uid();n.log("FlashAPI.Camera.publish: "+s),o.publish(r,s,n.extend(a,{camera:!0,onEvent:e(function l(e){"camera"===e.type&&(t(l),e.error?(n.log("FlashAPI.Camera.publish.error: "+e.error),i(e.error)):(n.log("FlashAPI.Camera.publish.success: "+s),i(null)))})}))},r(a,function(e){n.Camera.fallback.apply(n.Camera,e)}),a=[],n.extend(n.Camera.prototype,{_id:function(){return this.video.id},start:function(r){var a=this;o.cmd(this._id(),"camera.on",{callback:e(function i(e){t(i),e.error?(n.log("FlashAPI.camera.on.error: "+e.error),r(e.error,a)):(n.log("FlashAPI.camera.on.success: "+a._id()),a._active=!0,r(null,a))})})},stop:function(){this._active=!1,o.cmd(this._id(),"camera.off")},shot:function(){n.log("FlashAPI.Camera.shot:",this._id());var e=n.Flash.cmd(this._id(),"shot",{});return e.type="image/png",e.flashId=this._id(),e.isShot=!0,new n.Camera.Shot(e)}})}}),n.Camera.fallback=function(){a.push(arguments)}}()}(window,window.jQuery,FileAPI),r=[],a=function(){return FileAPI}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t){function n(){u=!1,i.length?l=i.concat(l):c=-1,l.length&&r()}function r(){var e,t;if(!u){for(e=setTimeout(n),u=!0,t=l.length;t;){for(i=l,l=[];++c<t;)i&&i[c].run();c=-1,t=l.length}i=null,u=!1,clearTimeout(e)}}function a(e,t){this.fun=e,this.array=t}function o(){}var i,s=e.exports={},l=[],u=!1,c=-1;s.nextTick=function(e){var t,n=new Array(arguments.length-1);if(arguments.length>1)for(t=1;t<arguments.length;t++)n[t-1]=arguments[t];l.push(new a(e,n)),1!==l.length||u||setTimeout(r,0)},a.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}}]);